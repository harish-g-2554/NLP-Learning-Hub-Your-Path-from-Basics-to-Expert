<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Module 6 — Sparse Vector (Embedding)</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
<head>
  <!-- ... your other head elements ... -->
  <style>
    .page-nav {
      padding: 12px 24px;
      background: rgba(17, 18, 28, 0.4);
      border-bottom: 1px solid #273041;
      margin-bottom: 24px;
    }
    .page-nav a {
      color: #cbd5ff;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .page-nav a:hover {
      text-decoration: underline;
    }
    /* ... rest of your styles ... */
  </style>
</head>
<body>
  <div class="scene">
    <header class="page-nav">
      <a href="{{ url_for('journey') }}">&larr; Back to All Modules</a>
    </header>
  <style>
    .lesson-wrap{max-width:1200px;margin:0 auto;padding:8px 16px 96px}
    .modules-hero{max-width:960px;margin:0 auto 18px;text-align:center}
    .modules-title{font-size:clamp(1.8rem,4.8vw,3rem);margin:8px 0 6px}
    .modules-hero p{color:#9fb0d8}

    .term{margin:18px 0;padding:22px;border-radius:16px;background:linear-gradient(180deg,rgba(17,18,28,.75),rgba(17,18,28,.45));border:1px solid #273041;box-shadow:0 10px 30px #0003,0 0 0 1px #1f2333 inset}
    .term h2, .term h3 {margin:0 0 8px;color:#e6e8ff}
    .t-desc{color:#9aa6d1; line-height: 1.6;}
    .twocol{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:10px}
    @media (max-width:900px){.twocol{grid-template-columns:1fr}}

    .diagram{padding:12px;border:1px solid #2b3449;border-radius:12px;background:rgba(12,14,22,.45);margin:10px 0}
    .d-caption{font-size:.82rem;color:#91a0c7;margin-bottom:6px;font-weight:700}
    .txt{width:100%;border-radius:12px;border:1px solid #2b3449;background:#0f1220;color:#e8ebff;padding:10px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .infobox{background:linear-gradient(180deg,rgba(6,182,212,.08),rgba(124,58,237,.08));border:1px solid #334155;border-radius:12px;padding:10px 12px;color:#bdd3f4}
    .formula-box{ background: rgba(12,14,22,.6); padding: 15px; border-radius: 10px; text-align: center; margin: 10px 0; }
    .formula{ font-family: 'Times New Roman', serif; font-size: 1.2rem; color: #c7d2fe; }
    
    .table{width:100%;border-collapse:separate;border-spacing:0 6px}
    .table th,.table td{padding:10px 12px;vertical-align:top; text-align: center;}
    .table thead th{color:#cbd5ff;text-align:center;border-bottom:1px solid #2b3449}
    .table tbody tr{background:rgba(12,14,22,.55);border:1px solid #2b3449}
    
    .qa{ margin:8px 0; background:rgba(17,18,28,.6); border:1px solid #273041; border-radius:10px; padding:10px 12px; }
    .qa summary{ cursor:pointer; color:#d7dcff; font-weight:700; }
    .qa .answer{ margin-top:8px; color:#b8c0e0; } 
    .qnum{ color:#a78bfa; margin-right:6px; }
  </style>
</head>
<body>
  <div class="scene">
    <header class="modules-hero">
      <h1 class="modules-title">Module 6: <span>Sparse Vector (Embedding)</span></h1>
      <p class="modules-sub">Explore traditional sparse representations like TF-IDF and Bag of Words for text analysis.</p>
    </header>

    <main class="lesson-wrap">

      <section class="term" id="intro">
        <h2>What are Sparse Vectors?</h2>
        <p class="t-desc">
          In NLP, we need to convert text into numbers so that machine learning algorithms can work with it. A <strong>sparse vector</strong> is one way to do this. Imagine a vector (a list of numbers) that has a position for every single word in your entire vocabulary. For any given document, most of these positions will be zero, because the document only contains a small subset of all possible words. This is why we call it "sparse"—it's mostly empty.
        </p>
        <div class="infobox">
          <strong>Analogy:</strong> Think of it like a light switch panel for every word in the English dictionary. For the sentence "The cat sat", you'd flip on the switches for "the", "cat", and "sat", and leave millions of others off. The resulting pattern of on/off switches is a sparse representation.
        </div>
      </section>

      <section class="term" id="bow">
        <h2>Bag-of-Words (BoW)</h2>
        <p class="t-desc">
          The <strong>Bag-of-Words (BoW)</strong> model is the simplest way to create a sparse vector. It represents a piece of text as an unordered collection (a "bag") of its words, disregarding grammar and even word order but keeping track of frequency.
        </p>
        <h3>How it works:</h3>
        <ol>
          <li><strong>Create a Vocabulary:</strong> First, you build a list of all unique words that appear in your entire collection of documents.</li>
          <li><strong>Create a Vector:</strong> For each document, you create a vector that is the same size as your vocabulary.</li>
          <li><strong>Count the Words:</strong> Each position in the vector corresponds to a word in the vocabulary. You fill each position with the number of times that word appears in the document.</li>
        </ol>
      </section>

      <section class="term" id="tfidf">
        <h2>Term Frequency-Inverse Document Frequency (TF-IDF)</h2>
        <p class="t-desc">
          A limitation of BoW is that it treats all words equally. But some words, like "the" or "is", are very common and don't tell us much about the document's topic. <strong>TF-IDF</strong> is a clever upgrade that gives more weight to words that are important to a document.
        </p>
        <div class="twocol">
            <div>
                <h3>Term Frequency (TF)</h3>
                <p class="t-desc">This is simply how often a word appears in a single document. It's often normalized by dividing by the total number of words in that document.</p>
                <div class="formula-box">
                    <p class="formula">TF(t, d) = (Number of times term t appears in document d) / (Total number of terms in document d)</p>
                </div>
            </div>
            <div>
                <h3>Inverse Document Frequency (IDF)</h3>
                <p class="t-desc">This measures how important a term is across all documents. It penalizes common words and rewards rare ones.</p>
                <div class="formula-box">
                    <p class="formula">IDF(t, D) = log(Total number of documents D / Number of documents with term t)</p>
                </div>
            </div>
        </div>
        <p class="t-desc" style="text-align: center; margin-top: 1rem;">The final TF-IDF score is simply the TF multiplied by the IDF. This score is high for words that are frequent in one document but rare across all other documents.</p>
      </section>

      <section class="term" id="lab-sparse-vector">
        <h2>Interactive Sparse Vector Lab</h2>
        <p class="t-desc">Enter your documents below (one per line), or upload a .txt file to calculate the Bag-of-Words and TF-IDF representations.</p>
        <div class="diagram">
            <div class="d-caption">Document Input</div>
            <div class="twocol">
                <div>
                    <label for="corpus" class="lbl">Enter Text</label>
                    <textarea id="corpus" class="txt" rows="5">the cat sat on the mat
the dog sat on the rug
the cat and the dog are friends</textarea>
                </div>
                <div>
                    <label for="fileInput" class="lbl">Or Upload a .txt File</label>
                    <input type="file" id="fileInput" accept=".txt" class="txt">
                </div>
            </div>
            <div style="margin-top:10px">
                <button class="btn primary" id="btnAnalyze" type="button">Analyze</button>
            </div>
        </div>
        <div id="results" style="display:none;" class="diagram">
            <h3>Results</h3>
            <div id="bow-results"></div>
            <div id="tfidf-results" style="margin-top: 2rem;"></div>
        </div>
      </section>
      
      <section class="term">
        <h2>Quick Quiz</h2>
        <details class="qa"><summary><span class="qnum">1.</span> What does "sparse" in "sparse vector" refer to?</summary><div class="answer">It refers to the fact that the vector is mostly filled with zeros, as a single document only contains a small fraction of the total vocabulary.</div></details>
        <details class="qa"><summary><span class="qnum">2.</span> What information does a Bag-of-Words model discard?</summary><div class="answer">It discards grammar and word order.</div></details>
        <details class="qa"><summary><span class="qnum">3.</span> What is the main problem with the Bag-of-Words model that TF-IDF tries to solve?</summary><div class="answer">BoW treats all words as equally important. TF-IDF gives more weight to words that are more indicative of a document's topic.</div></details>
        <details class="qa"><summary><span class="qnum">4.</span> In TF-IDF, what does a high IDF score for a word mean?</summary><div class="answer">A high IDF score means the word is rare across the collection of documents, and is therefore likely to be more important.</div></details>
        <details class="qa"><summary><span class="qnum">5.</span> If a word appears in every single document, what will its IDF score be?</summary><div class="answer">Its IDF score will be log(N/N) = log(1) = 0.</div></details>
        <details class="qa"><summary><span class="qnum">6.</span> What is "Term Frequency"?</summary><div class="answer">It's the frequency of a word in a specific document.</div></details>
        <details class="qa"><summary><span class="qnum">7.</span> What is one common application of TF-IDF?</summary><div class="answer">Information retrieval and search engines, to rank documents based on their relevance to a query.</div></details>
        <details class="qa"><summary><span class="qnum">8.</span> What is a "vocabulary" in the context of these models?</summary><div class="answer">The set of all unique words across all documents in the corpus.</div></details>
        <details class="qa"><summary><span class="qnum">9.</span> Why do we often remove common "stopwords" before creating BoW or TF-IDF vectors?</summary><div class="answer">Because they don't carry much meaningful information about the topic of the document and can dilute the importance of more significant words.</div></details>
        <details class="qa"><summary><span class="qnum">10.</span> Between "car" and "the", which word would you expect to have a higher IDF score in a large corpus of general English text?</summary><div class="answer">"car", because it is much less common than "the".</div></details>
      </section>

    </main>
  </div>

  <script>
    async function postJSON(url, payload) {
      const res = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload),
      });
      if (!res.ok) {
        const errData = await res.json().catch(() => ({ error: `HTTP ${res.status}` }));
        throw new Error(errData.error);
      }
      return res.json();
    }

    document.getElementById('fileInput').addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('corpus').value = e.target.result;
            };
            reader.readAsText(file);
        }
    });

    document.getElementById('btnAnalyze').addEventListener('click', async () => {
        const corpus = document.getElementById('corpus').value;
        if (!corpus) {
            alert('Please enter at least one document or upload a file.');
            return;
        }
        try {
            const data = await postJSON('/api/sparse-vectors', { corpus });
            
            // Render BoW results
            let bowHtml = '<h4>Bag-of-Words (BoW)</h4><table class="table"><thead><tr><th>Document</th>';
            data.vocabulary.forEach(term => bowHtml += `<th>${term}</th>`);
            bowHtml += '</tr></thead><tbody>';
            data.bow.forEach((doc_vector, i) => {
                bowHtml += `<tr><td>Doc ${i+1}</td>`;
                doc_vector.forEach(count => bowHtml += `<td>${count}</td>`);
                bowHtml += '</tr>';
            });
            bowHtml += '</tbody></table>';
            document.getElementById('bow-results').innerHTML = bowHtml;

            // Render TF-IDF results
            let tfidfHtml = '<h4>TF-IDF</h4><table class="table"><thead><tr><th>Document</th>';
            data.vocabulary.forEach(term => tfidfHtml += `<th>${term}</th>`);
            tfidfHtml += '</tr></thead><tbody>';
            data.tfidf.forEach((doc_vector, i) => {
                tfidfHtml += `<tr><td>Doc ${i+1}</td>`;
                doc_vector.forEach(score => tfidfHtml += `<td>${score.toFixed(4)}</td>`);
                tfidfHtml += '</tr>';
            });
            tfidfHtml += '</tbody></table>';
            document.getElementById('tfidf-results').innerHTML = tfidfHtml;

            document.getElementById('results').style.display = 'block';
        } catch (e) {
            alert(`Error: ${e.message}`);
        }
    });
  </script>
</body>
</html>
